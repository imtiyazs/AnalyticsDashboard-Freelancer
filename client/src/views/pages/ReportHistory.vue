<template>
  <div class="wrapper">
    <div class="animated fadeIn">
      <b-container class="bv-example-row" fluid>
        <b-row>
          <b-table hover :items="usersHistory.reports" :fields="fields">
            <!-- <template slot="reportName" slot-scope="data">
              <div> <b>{{data.value}}</b></div>
            </template> -->
            <template slot="analyticsDataName" slot-scope="data">
              <div @click="displayDashboard(data.value)"><b>{{data.value}}</b></div>
            </template>

          </b-table>
        </b-row>
      </b-container>
      <div>
        <b-modal id="displayMyDashboard" ref="displayMyDashboard" hide-footer :title="'Dashboard :: ' + this.dashboardDisplay.name" size="400">
          <div v-if="dashboardDisplay.data!==null" >
            
            <!-- Report File Name -->
            <div >
              <span>
                Report Name:
                <span >
                  <!-- {{CapitalizeFirstLetter(nameOfReport)}} -->
                  
                </span>
              </span>
              <br>
              <span >
                Analytic Report Name:
                  {{this.dashboardDisplay.data.analyticsDataName}}
              </span>
            </div>
            <!-- **** -->
            <div class="card-body">
              <div class="row" >
                <div
                  v-for="(singleGraph,index) in dashboardDisplay.data.analyticsData"
                  :key="index"
                  class="col-4"
                >
                  <div v-if="singleGraph.typeOfGraph ==='BarGraph'">
                    <b-card
                      :header="CapitalizeFirstLetter(singleGraph.columnName)"
                      style="font-weight:500"
                    >
                      <div class="chart-wrapper">
                        <BarCharts
                          :datasetBar="returnFrequency(singleGraph.data)"
                          :columnName="singleGraph.columnName"
                          chartId="chart-bar-01"
                        />
                      </div>
                    </b-card>
                  </div>
                  <div v-if="singleGraph.typeOfGraph ==='PieGraph'">
                    <b-card
                      :header="CapitalizeFirstLetter(singleGraph.columnName)"
                      style="font-weight:500"
                    >
                      <div class="chart-wrapper">
                        <PieCharts
                          :datasetPie="returnFrequency(singleGraph.data)"
                          chartId="chart-pie-01"
                        />
                      </div>
                    </b-card>
                  </div>
                </div>
              </div>
            </div>
            <!-- **** -->
                
          </div>
        </b-modal>
      </div>
    </div>
  </div>
</template>


<script>
import router from "../../router";
import axios from "axios";
import BarCharts from "@/views/pages/ChartComponent/BarCharts";
import PieCharts from "@/views/pages/ChartComponent/PieCharts";

export default {
  name: "ReportHistory",
  components:{
    BarCharts,
    PieCharts
  },
  data() {
    return {
      user:{},
      fields: [ 'fileName', 'reportName', 'analyticsDataName' ],
      dashboardDisplay :{
        name:'',
        data:null
      },
      usersHistory : {"username":"joel","reports":[{"fileName":"toBeChanges","reportName":"drfgdgf","reportData":{"DepT1gp2":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","1.0","0.0"],"DepT2Gp2":["0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0"],"DepT3gp2":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0"],"age":["23.0","21.0","25.0","30.0","45.0","22.0","22.0","26.0","23.0","21.0","23.0","19.0","23.0","19.0","21.0","20.0","24.0","27.0","23.0","22.0","46.0","19.0","22.0","37.0","32.0","30.0","25.0","21.0","45.0","21.0"],"confid1":["15.0","14.0","12.0","11.0","16.0","13.0","21.0","17.0","22.0","20.0","28.0","20.0","21.0","24.0","29.0","16.0","14.0","15.0","13.0","22.0","21.0","13.0","28.0","29.0","17.0","20.0","24.0","12.0","22.0","21.0"],"confid2":["16.0","15.0","18.0","16.0","16.0","20.0","22.0","20.0","23.0","25.0","27.0","25.0","26.0","28.0","30.0","14.0","14.0","13.0","20.0","18.0","19.0","20.0","22.0","22.0","26.0","28.0","28.0","20.0","35.0","30.0"],"confid3":["14.0","18.0","19.0","20.0","20.0","22.0","23.0","26.0","26.0","27.0","29.0","30.0","30.0","32.0","34.0","18.0","19.0","20.0","22.0","22.0","23.0","23.0","26.0","27.0","28.0","29.0","30.0","30.0","32.0","32.0"],"depress1":["44.0","42.0","40.0","43.0","44.0","43.0","37.0","46.0","37.0","50.0","39.0","44.0","47.0","38.0","50.0","45.0","42.0","49.0","39.0","39.0","44.0","43.0","33.0","39.0","47.0","38.0","45.0","50.0","45.0","34.0"],"depress2":["44.0","42.0","40.0","43.0","45.0","42.0","36.0","47.0","37.0","48.0","36.0","43.0","47.0","35.0","47.0","44.0","40.0","49.0","30.0","38.0","44.0","39.0","33.0","40.0","45.0","30.0","40.0","48.0","40.0","30.0"],"depress3":["40.0","40.0","38.0","43.0","43.0","38.0","35.0","42.0","35.0","46.0","34.0","40.0","47.0","35.0","45.0","40.0","39.0","44.0","30.0","36.0","44.0","37.0","32.0","40.0","42.0","29.0","38.0","50.0","42.0","32.0"],"exam":["52.0","55.0","58.0","60.0","58.0","62.0","59.0","70.0","60.0","70.0","72.0","82.0","79.0","80.0","90.0","56.0","53.0","59.0","64.0","63.0","64.0","63.0","67.0","71.0","73.0","80.0","83.0","85.0","78.0","84.0"],"fost1":["50.0","47.0","44.0","47.0","46.0","39.0","32.0","44.0","40.0","47.0","38.0","32.0","39.0","36.0","37.0","41.0","38.0","42.0","44.0","32.0","39.0","42.0","37.0","41.0","43.0","46.0","30.0","33.0","40.0","39.0"],"fost2":["48.0","45.0","39.0","42.0","45.0","40.0","33.0","37.0","40.0","45.0","37.0","28.0","35.0","32.0","36.0","40.0","37.0","41.0","39.0","31.0","40.0","38.0","38.0","40.0","36.0","40.0","28.0","29.0","30.0","36.0"],"fost3":["45.0","44.0","36.0","41.0","43.0","39.0","32.0","32.0","40.0","46.0","32.0","23.0","35.0","30.0","34.0","38.0","35.0","40.0","34.0","32.0","38.0","36.0","36.0","40.0","34.0","37.0","25.0","25.0","25.0","30.0"],"group":["2.0","2.0","1.0","1.0","2.0","1.0","2.0","1.0","2.0","1.0","2.0","1.0","1.0","1.0","2.0","1.0","1.0","1.0","2.0","1.0","1.0","2.0","1.0","1.0","2.0","2.0","2.0","2.0","2.0","2.0"],"id":["4.0","10.0","9.0","3.0","12.0","11.0","6.0","5.0","8.0","13.0","14.0","1.0","15.0","7.0","2.0","27.0","25.0","19.0","18.0","23.0","21.0","26.0","29.0","17.0","20.0","28.0","22.0","24.0","16.0","30.0"],"mah_1":["0.5699841856180975","1.6594030523640948","3.5404715296679132","2.454214336946473","0.9443035774539884","1.6257057755287583","4.174471731634222","1.0261058941319283","1.7053103413369513","3.087321393332276","2.914016344284633","0.34699776947198","1.5886240601451136","1.5076581612072992","10.240180362635149","1.1776466899748874","1.0564668233584227","3.874891021926158","2.7101640508965827","3.5488594177535093","0.500719166169066","1.4739117918895877","9.129575796885938","6.206584194486002","1.7190980705117975","1.5015533464444877","1.9240376343782855","7.557641133774945","1.1884922349412206","6.045590110850241"],"sex":["1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0"]},"analyticsDataName":"Hsllo","analyticsData":[{"data":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","1.0","0.0"],"typeOfGraph":"PieGraph","columnName":"DepT1gp2"},{"data":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","1.0","0.0"],"typeOfGraph":"BarGraph","columnName":"DepT1gp2"},{"data":["0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0"],"typeOfGraph":"BarGraph","columnName":"DepT2Gp2"},{"data":["0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0"],"typeOfGraph":"PieGraph","columnName":"DepT2Gp2"}]},{"fileName":"toBeChanges","reportName":"sdcscd","reportData":{"DepT1gp2":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","1.0","0.0"],"DepT2Gp2":["0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0"],"DepT3gp2":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0"],"age":["23.0","21.0","25.0","30.0","45.0","22.0","22.0","26.0","23.0","21.0","23.0","19.0","23.0","19.0","21.0","20.0","24.0","27.0","23.0","22.0","46.0","19.0","22.0","37.0","32.0","30.0","25.0","21.0","45.0","21.0"],"confid1":["15.0","14.0","12.0","11.0","16.0","13.0","21.0","17.0","22.0","20.0","28.0","20.0","21.0","24.0","29.0","16.0","14.0","15.0","13.0","22.0","21.0","13.0","28.0","29.0","17.0","20.0","24.0","12.0","22.0","21.0"],"confid2":["16.0","15.0","18.0","16.0","16.0","20.0","22.0","20.0","23.0","25.0","27.0","25.0","26.0","28.0","30.0","14.0","14.0","13.0","20.0","18.0","19.0","20.0","22.0","22.0","26.0","28.0","28.0","20.0","35.0","30.0"],"confid3":["14.0","18.0","19.0","20.0","20.0","22.0","23.0","26.0","26.0","27.0","29.0","30.0","30.0","32.0","34.0","18.0","19.0","20.0","22.0","22.0","23.0","23.0","26.0","27.0","28.0","29.0","30.0","30.0","32.0","32.0"],"depress1":["44.0","42.0","40.0","43.0","44.0","43.0","37.0","46.0","37.0","50.0","39.0","44.0","47.0","38.0","50.0","45.0","42.0","49.0","39.0","39.0","44.0","43.0","33.0","39.0","47.0","38.0","45.0","50.0","45.0","34.0"],"depress2":["44.0","42.0","40.0","43.0","45.0","42.0","36.0","47.0","37.0","48.0","36.0","43.0","47.0","35.0","47.0","44.0","40.0","49.0","30.0","38.0","44.0","39.0","33.0","40.0","45.0","30.0","40.0","48.0","40.0","30.0"],"depress3":["40.0","40.0","38.0","43.0","43.0","38.0","35.0","42.0","35.0","46.0","34.0","40.0","47.0","35.0","45.0","40.0","39.0","44.0","30.0","36.0","44.0","37.0","32.0","40.0","42.0","29.0","38.0","50.0","42.0","32.0"],"exam":["52.0","55.0","58.0","60.0","58.0","62.0","59.0","70.0","60.0","70.0","72.0","82.0","79.0","80.0","90.0","56.0","53.0","59.0","64.0","63.0","64.0","63.0","67.0","71.0","73.0","80.0","83.0","85.0","78.0","84.0"],"fost1":["50.0","47.0","44.0","47.0","46.0","39.0","32.0","44.0","40.0","47.0","38.0","32.0","39.0","36.0","37.0","41.0","38.0","42.0","44.0","32.0","39.0","42.0","37.0","41.0","43.0","46.0","30.0","33.0","40.0","39.0"],"fost2":["48.0","45.0","39.0","42.0","45.0","40.0","33.0","37.0","40.0","45.0","37.0","28.0","35.0","32.0","36.0","40.0","37.0","41.0","39.0","31.0","40.0","38.0","38.0","40.0","36.0","40.0","28.0","29.0","30.0","36.0"],"fost3":["45.0","44.0","36.0","41.0","43.0","39.0","32.0","32.0","40.0","46.0","32.0","23.0","35.0","30.0","34.0","38.0","35.0","40.0","34.0","32.0","38.0","36.0","36.0","40.0","34.0","37.0","25.0","25.0","25.0","30.0"],"group":["2.0","2.0","1.0","1.0","2.0","1.0","2.0","1.0","2.0","1.0","2.0","1.0","1.0","1.0","2.0","1.0","1.0","1.0","2.0","1.0","1.0","2.0","1.0","1.0","2.0","2.0","2.0","2.0","2.0","2.0"],"id":["4.0","10.0","9.0","3.0","12.0","11.0","6.0","5.0","8.0","13.0","14.0","1.0","15.0","7.0","2.0","27.0","25.0","19.0","18.0","23.0","21.0","26.0","29.0","17.0","20.0","28.0","22.0","24.0","16.0","30.0"],"mah_1":["0.5699841856180975","1.6594030523640948","3.5404715296679132","2.454214336946473","0.9443035774539884","1.6257057755287583","4.174471731634222","1.0261058941319283","1.7053103413369513","3.087321393332276","2.914016344284633","0.34699776947198","1.5886240601451136","1.5076581612072992","10.240180362635149","1.1776466899748874","1.0564668233584227","3.874891021926158","2.7101640508965827","3.5488594177535093","0.500719166169066","1.4739117918895877","9.129575796885938","6.206584194486002","1.7190980705117975","1.5015533464444877","1.9240376343782855","7.557641133774945","1.1884922349412206","6.045590110850241"],"sex":["1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","1.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0","2.0"]},"analyticsDataName":"sdfsdfsdfds","analyticsData":[{"data":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","1.0","0.0"],"typeOfGraph":"BarGraph","columnName":"DepT1gp2"},{"data":["0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0"],"typeOfGraph":"BarGraph","columnName":"DepT2Gp2"}]}],"_id":"5c15f1029a45bb7eceeba747"}
    };
  },
  methods: {
    CapitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    },
    returnFrequency(arrayObject) {
      let counts = {};
      for (let i = 0; i < arrayObject.length; i++) {
        let num = arrayObject[i];
        counts[num] = counts[num] ? counts[num] + 1 : 1;
      }
      return counts;
    },
    displayDashboard(DashboardName){
      //alert(DashboardName)
      this.dashboardDisplay.name = DashboardName
      this.$refs.displayMyDashboard.show()
      this.dashboardDisplay.data = this.getDashboardDetails(DashboardName)
      //console.log(this.dashboardDisplay)

      
    },
    getDashboardDetails(DashboardName){
      //listOfReports = this.usersHistory.reports
      let returnData = null
      this.usersHistory.reports.forEach(element => {
        if(element.analyticsDataName === DashboardName){
          console.log(element)
          returnData = element
        }
      });
      return returnData
    }
  },
  mounted() {
    /** Check User Logged In */
    let self = this;
    axios
      .post("/o/user")
      .then(response => {
        self.user = response.data
        //console.log(response.data)
        this.userLogged = true;
      })
      .catch(errors => {
        router.push("/login");
      });
      
      // Get History of User

      // axios
      // .post("/o/user")
      // .then(response => {
      //   self.usersHistory = response.data
      //   //console.log(response.data)

      // })
      // .catch(errors => {
      //   router.push("/login");
      // });

  }
};
</script>
<style scoped>
div.modal.displayMyDashboard .modal-dialog {
  width: 100%; 
}
</style>
